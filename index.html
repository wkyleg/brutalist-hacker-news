<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8" />
    <title>minimal hn</title>
    <meta
      name="viewport"
      content="viewport-fit=cover, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <link rel="icon" type="image/x-icon" href="assets/icon/favicon.ico" />
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#4e8ef7" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta
      name="description"
      content="Explore Hacker News in a new light with our minimalist and accessible reader. Dive into the latest tech stories, discussions, and insights with ease and comfort. Perfect for those who value clarity, simplicity, and inclusivity in the stucture of webpages. Also an interesting view of brutalist and Cyberpunk aesthetics."
    />
  </head>

  <body>
    <header
      class="title-content layers glitch-slow"
      aria-label="Main navigation"
    >
      <h1 id="title" class="font glitch">hn</h1>
      <nav
        id="nav-button-top"
        class="text-link-button"
        aria-label="Top Stories"
      >
        [&#128285;]
      </nav>
      <nav
        id="nav-button-new"
        class="text-link-button"
        aria-label="New Stories"
      >
        [&#10561;]
      </nav>
      <nav
        id="nav-button-best"
        class="text-link-button"
        aria-label="Best Stories"
      >
        [&#9812;]
      </nav>
      <nav id="nav-button-ask" class="text-link-button" aria-label="Ask HN">
        [?]
      </nav>
      <nav id="nav-button-show" class="text-link-button" aria-label="Show HN">
        [&#10547;]
      </nav>
      <nav id="nav-button-job" class="text-link-button" aria-label="Jobs">
        [$]
      </nav>
      <nav
        id="nav-button-favorites"
        class="text-link-button"
        aria-label="Favorites"
      >
        [&hearts;]
      </nav>
      <nav
        id="nav-button-settings"
        class="text-link-button"
        aria-label="Settings"
      >
        [⚙]
      </nav>
    </header>
    <main class="main-content">
      <section
        id="loading-outlet"
        class="use-gpu-rendering stories-loading-animation"
        style="display: none"
        aria-live="polite"
      ></section>
      <section
        id="top-outlet"
        class="use-gpu-rendering"
        style="display: none"
        aria-live="polite"
      ></section>
      <section
        id="new-outlet"
        class="use-gpu-rendering"
        style="display: none"
        aria-live="polite"
      ></section>
      <section
        id="best-outlet"
        class="use-gpu-rendering"
        style="display: none"
        aria-live="polite"
      ></section>
      <section
        id="ask-outlet"
        class="use-gpu-rendering"
        style="display: none"
        aria-live="polite"
      ></section>
      <section
        id="show-outlet"
        class="use-gpu-rendering"
        style="display: none"
        aria-live="polite"
      ></section>
      <section
        id="job-outlet"
        class="use-gpu-rendering"
        style="display: none"
        aria-live="polite"
      ></section>
      <section
        id="favorites-outlet"
        class="use-gpu-rendering"
        style="display: none"
        aria-live="polite"
      ></section>
      <section
        id="settings-outlet"
        class="use-gpu-rendering"
        style="display: none"
        aria-live="polite"
      >
        <div
          class="settings-content"
          role="table"
          id="settings-content-container"
        >
          <h3>THEME</h3>
          <div class="setting-element" id="setting--color-primary">
            <div class="setting-name" role="label">primary</div>
            <div class="setting-new-value-input">
              <input
                type="color"
                id="setting-input--color-primary"
                style="border-color: var(--color-primary)"
              />
            </div>
            <button
              class="setting-apply-button"
              id="apply-setting--color-primary"
            >
              APPLY
            </button>
            <button
              class="setting-reset-button"
              id="reset-setting--color-primary"
            >
              RESET
            </button>
          </div>
          <div class="setting-element" id="setting--color-secondary">
            <div class="setting-name" role="label">secondary</div>
            <div class="setting-new-value-input">
              <input type="color" id="setting-input--color-secondary" />
            </div>
            <button
              class="setting-apply-button"
              id="apply-setting--color-secondary"
            >
              APPLY
            </button>
            <button
              class="setting-reset-button"
              id="reset-setting--color-secondary"
            >
              RESET
            </button>
          </div>
          <div class="setting-element" id="setting--color-accent-1">
            <div class="setting-name" role="label">accent-1</div>
            <div class="setting-new-value-input">
              <input type="color" id="setting-input--color-accent-1" />
            </div>
            <button
              class="setting-apply-button"
              id="apply-setting--color-accent-1"
            >
              APPLY
            </button>
            <button
              class="setting-reset-button"
              id="reset-setting--color-accent-1"
            >
              RESET
            </button>
          </div>
          <div class="setting-element" id="setting--color-accent-2">
            <div class="setting-name" role="label">accent-2</div>
            <div class="setting-new-value-input">
              <input type="color" id="setting-input--color-accent-2" />
            </div>
            <button
              class="setting-apply-button"
              id="apply-setting--color-accent-2"
            >
              APPLY
            </button>
            <button
              class="setting-reset-button"
              id="reset-setting--color-accent-2"
            >
              RESET
            </button>
          </div>
          <div class="setting-element" id="setting--color-dark">
            <div class="setting-name" role="label">dark</div>
            <div class="setting-new-value-input">
              <input type="color" id="setting-input--color-dark" />
            </div>
            <button class="setting-apply-button" id="apply-setting--color-dark">
              APPLY
            </button>
            <button class="setting-reset-button" id="reset-setting--color-dark">
              RESET
            </button>
          </div>
          <div class="setting-element" id="setting--color-light">
            <div class="setting-name" role="label">light</div>
            <div class="setting-new-value-input">
              <input type="color" id="setting-input--color-light" />
            </div>
            <button
              class="setting-apply-button"
              id="apply-setting--color-light"
            >
              APPLY
            </button>
            <button
              class="setting-reset-button"
              id="reset-setting--color-light"
            >
              RESET
            </button>
          </div>
          <div class="setting-element" id="setting--color-text-main">
            <div class="setting-name" role="label">text-main</div>
            <div class="setting-new-value-input">
              <input type="color" id="setting-input--color-text-main" />
            </div>
            <button
              class="setting-apply-button"
              id="apply-setting--color-text-main"
            >
              APPLY
            </button>
            <button
              class="setting-reset-button"
              id="reset-setting--color-text-main"
            >
              RESET
            </button>
          </div>
        </div>
        <p>... or use pre built theme ...</p>
        <div class="theme-buttons-row">
          <button id="button-theme-default">DEFAULT</button>
          <button id="button-theme-hacker">H@CK3R</button>
          <button id="button-theme-l33t">l33+</button>
          <button id="button-theme-dream-pop">DrE∀M P♡P</button>
          <button id="button-theme-solar-flare">S☉l@r ⒻⓁⒶⓇⒺ</button>
          <button id="button-theme-hippie">Ħłρρłε</button>
        </div>

        <br />
        <button id="download-theme-button" class="settings-favorites-button">
          DOWNLOAD CURRENT THEME
        </button>
        <br />
        <br />
        <br />

        <h3>FAVORITES</h3>
        <button
          id="download-favorites-button"
          class="settings-favorites-button"
        >
          DOWNLOAD FAVORITES
        </button>
        <button
          id="clear-all-favorites-button"
          class="settings-favorites-button"
        >
          CLEAR ALL FAVORITES
        </button>

        <br />
        <br />
        <br />

        <section id="pwa-install-instructions" class="pwa-install-section">
          <h3>ADD TO HOME SCREEN (PWA SUPPORT)</h3>
          <p>
            Follow these steps to add this site to your Home Screen or desktop
            for quick access, just like an app!
          </p>

          <h4>On Android:</h4>
          <ol>
            <li>Open the website in your browser.</li>
            <li>
              Tap the menu icon (3 dots in upper right-hand corner) and tap 'Add
              to Home screen'.
            </li>
            <li>
              You'll be able to enter a name for the shortcut and then Chrome
              will add it to your home screen.
            </li>
          </ol>

          <h4>On iOS:</h4>
          <ol>
            <li>Open the website in Safari on your iPhone or iPad.</li>
            <li>
              Tap the 'Share' button (the square with an arrow pointing out of
              it) at the bottom of the screen.
            </li>
            <li>
              Scroll down to the list of actions and tap 'Add to Home Screen'.
            </li>
            <li>
              Enter a name for the shortcut and then Safari will add it to your
              home screen.
            </li>
          </ol>

          <h4>On Chrome Desktop:</h4>
          <ol>
            <li>Open the website in Chrome on your computer.</li>
            <li>
              Look for a '+' icon in the address bar at the right or an
              'Install' icon in the right side of the address bar.
            </li>
            <li>
              Click the icon and follow the prompt to install the application.
            </li>
          </ol>

          <h4>On Microsoft Edge Desktop:</h4>
          <ol>
            <li>Open the website in Edge on your computer.</li>
            <li>
              Click on the 'Settings and more' menu (3 dots in upper right-hand
              corner) or look for an 'Install' icon on the right side of the
              address bar.
            </li>
            <li>Select 'Apps' > 'Install this site as an app'.</li>
            <li>Enter a name for the app and confirm the installation.</li>
          </ol>
        </section>

        <br />

        <h3>ABOUT</h3>
        <p>
          An experiment with
          <a href="https://brutalist-web.design/"> brutalist web design </a>
          <br />
          <br />
          You can contribute to the development of this page on
          <a href="https://github.com/wkyleg/brutalist-hacker-news">GitHub</a>
        </p>
      </section>
    </main>
  </body>

  <style>
        :root {
          /* Default olor scheme inspired by brutalist design and cyberpunk */
          --color-primary:#e30613;
          --color-secondary: #ffed00;
          --color-accent-1: #f6d365;
          --color-accent-2: #fda085;
          --color-dark: #3c3c3c
          --color-light: #FFFFFF;
          --color-text-main: #2f4f4f ;

          /* Shading Utilities */
          --text-shadow-highlight: 1px 1px var(--color-primary),
            -1px -1px var(--color-secondary);
          --box-shadow-highlight: 5px 5px var(--color-primary),
            -5px -5px var(--color-secondary);
          --box-shadow-highlight-mild: 1px 1px var(--color-primary),
            -1px -1px var(--color-secondary);
          --backgound-linear-gradient: linear-gradient(
            120deg,
            var(--color-accent-1) 0%,
            var(--color-accent-2) 100%
          );

          /* Sizing utilities */
          --size-xxs: 0.5rem;
          --size-xs: 0.75rem;
          --size-sm: 1rem;
          --size-md: 1.5rem;
          --size-lg: 2rem;
          --size-xl: 3rem;
          --size-xxl: 6rem;

          /* Breakpoints */
          --breakpoint-mobile: 600px;
          --breakpoint-tablet: 1100px;
          --breakpoint-desktop: 1600px;

          /* Misc */
          --top-level-padding-side: 1%;
        }

        * {
          /*  Default to best Apple Monospace fonts, then Chrome fonts, then windows fonts */
          font-family: "Menlo", "SF Mono", "Fira Code", "Roboto Mono", "Consolas", "Liberation Mono", "Courier New", monospace;
          border-radius: 0;
          color: var(--color-text-main);
          border: 0;
          border-radius: 0;
        }

        input {
          color: var(--color-text-main);
          padding-block: 0;
          padding-inline: 0;
          margin-block: 0;
          margin-inline: 0;
        }

        button {
          cursor: pointer;
          background: var(--color-light);
          color: var(--color-text-main);
        }

        .settings-favorites-button {
          height: var(--size-md);
        }

        button:hover {
          filter: brightness(1.2), contrast(1.2);
          box-shadow: inset 1px 1px 1px var(--color-text-main);
        }

    /* Glitch Animation */
    /*
    * Inspired by https://codepen.io/mattgrosswork/pen/VwprebG
    */

    .layers {
      position: relative;
    }

    .layers::before,
    .layers::after {
      content: attr(data-text);
      position: absolute;
      width: 110%;
      z-index: -1;
    }

    .layers::before {
      top: 10px;
      left: 15px;
      color: var(--color-primary);
    }

    .layers::after {
      top: 5px;
      left: -10px;
      color: var(--color-secondary);
    }

    .single-path {
      clip-path: polygon(
        0% 12%,
        53% 12%,
        53% 26%,
        25% 26%,
        25% 86%,
        31% 86%,
        31% 0%,
        53% 0%,
        53% 84%,
        92% 84%,
        92% 82%,
        70% 82%,
        70% 29%,
        78% 29%,
        78% 65%,
        69% 65%,
        69% 66%,
        77% 66%,
        77% 45%,
        85% 45%,
        85% 26%,
        97% 26%,
        97% 28%,
        84% 28%,
        84% 34%,
        54% 34%,
        54% 89%,
        30% 89%,
        30% 58%,
        83% 58%,
        83% 5%,
        68% 5%,
        68% 36%,
        62% 36%,
        62% 1%,
        12% 1%,
        12% 34%,
        60% 34%,
        60% 57%,
        98% 57%,
        98% 83%,
        1% 83%,
        1% 53%,
        91% 53%,
        91% 84%,
        8% 84%,
        8% 83%,
        4% 83%
      );
    }

    .paths {
      animation: paths 5s step-end infinite;
    }

    @keyframes paths {
      0% {
        clip-path: polygon(
          0% 43%,
          83% 43%,
          83% 22%,
          23% 22%,
          23% 24%,
          91% 24%,
          91% 26%,
          18% 26%,
          18% 83%,
          29% 83%,
          29% 17%,
          41% 17%,
          41% 39%,
          18% 39%,
          18% 82%,
          54% 82%,
          54% 88%,
          19% 88%,
          19% 4%,
          39% 4%,
          39% 14%,
          76% 14%,
          76% 52%,
          23% 52%,
          23% 35%,
          19% 35%,
          19% 8%,
          36% 8%,
          36% 31%,
          73% 31%,
          73% 16%,
          1% 16%,
          1% 56%,
          50% 56%,
          50% 8%
        );
      }

      5% {
        clip-path: polygon(
          0% 29%,
          44% 29%,
          44% 83%,
          94% 83%,
          94% 56%,
          11% 56%,
          11% 64%,
          94% 64%,
          94% 70%,
          88% 70%,
          88% 32%,
          18% 32%,
          18% 96%,
          10% 96%,
          10% 62%,
          9% 62%,
          9% 84%,
          68% 84%,
          68% 50%,
          52% 50%,
          52% 55%,
          35% 55%,
          35% 87%,
          25% 87%,
          25% 39%,
          15% 39%,
          15% 88%,
          52% 88%
        );
      }

      30% {
        clip-path: polygon(
          0% 53%,
          93% 53%,
          93% 62%,
          68% 62%,
          68% 37%,
          97% 37%,
          97% 89%,
          13% 89%,
          13% 45%,
          51% 45%,
          51% 88%,
          17% 88%,
          17% 54%,
          81% 54%,
          81% 75%,
          79% 75%,
          79% 76%,
          38% 76%,
          38% 28%,
          61% 28%,
          61% 12%,
          55% 12%,
          55% 62%,
          68% 62%,
          68% 51%,
          0% 51%,
          0% 92%,
          63% 92%,
          63% 4%,
          65% 4%
        );
      }

      45% {
        clip-path: polygon(
          0% 33%,
          2% 33%,
          2% 69%,
          58% 69%,
          58% 94%,
          55% 94%,
          55% 25%,
          33% 25%,
          33% 85%,
          16% 85%,
          16% 19%,
          5% 19%,
          5% 20%,
          79% 20%,
          79% 96%,
          93% 96%,
          93% 50%,
          5% 50%,
          5% 74%,
          55% 74%,
          55% 57%,
          96% 57%,
          96% 59%,
          87% 59%,
          87% 65%,
          82% 65%,
          82% 39%,
          63% 39%,
          63% 92%,
          4% 92%,
          4% 36%,
          24% 36%,
          24% 70%,
          1% 70%,
          1% 43%,
          15% 43%,
          15% 28%,
          23% 28%,
          23% 71%,
          90% 71%,
          90% 86%,
          97% 86%,
          97% 1%,
          60% 1%,
          60% 67%,
          71% 67%,
          71% 91%,
          17% 91%,
          17% 14%,
          39% 14%,
          39% 30%,
          58% 30%,
          58% 11%,
          52% 11%,
          52% 83%,
          68% 83%
        );
      }

      76% {
        clip-path: polygon(
          0% 26%,
          15% 26%,
          15% 73%,
          72% 73%,
          72% 70%,
          77% 70%,
          77% 75%,
          8% 75%,
          8% 42%,
          4% 42%,
          4% 61%,
          17% 61%,
          17% 12%,
          26% 12%,
          26% 63%,
          73% 63%,
          73% 43%,
          90% 43%,
          90% 67%,
          50% 67%,
          50% 41%,
          42% 41%,
          42% 46%,
          50% 46%,
          50% 84%,
          96% 84%,
          96% 78%,
          49% 78%,
          49% 25%,
          63% 25%,
          63% 14%
        );
      }

      90% {
        clip-path: polygon(
          0% 41%,
          13% 41%,
          13% 6%,
          87% 6%,
          87% 93%,
          10% 93%,
          10% 13%,
          89% 13%,
          89% 6%,
          3% 6%,
          3% 8%,
          16% 8%,
          16% 79%,
          0% 79%,
          0% 99%,
          92% 99%,
          92% 90%,
          5% 90%,
          5% 60%,
          0% 60%,
          0% 48%,
          89% 48%,
          89% 13%,
          80% 13%,
          80% 43%,
          95% 43%,
          95% 19%,
          80% 19%,
          80% 85%,
          38% 85%,
          38% 62%
        );
      }

      1%,
      7%,
      33%,
      47%,
      78%,
      93% {
        clip-path: none;
      }
    }

    .movement {
      /* Normally this position would be absolute & on the layers, set to relative here so we can see it on the div */
      position: relative;
      animation: movement 8s step-end infinite;
    }

    @keyframes movement {
      0% {
        top: 0px;
        left: -20px;
      }

      15% {
        top: 10px;
        left: 10px;
      }

      60% {
        top: 5px;
        left: -10px;
      }

      75% {
        top: -5px;
        left: 20px;
      }

      100% {
        top: 10px;
        left: 5px;
      }
    }

    .opacity {
      animation: opacity 5s step-end infinite;
    }

    @keyframes opacity {
      0% {
        opacity: 0.1;
      }

      5% {
        opacity: 0.7;
      }

      30% {
        opacity: 0.4;
      }

      45% {
        opacity: 0.6;
      }

      76% {
        opacity: 0.4;
      }

      90% {
        opacity: 0.8;
      }

      1%,
      7%,
      33%,
      47%,
      78%,
      93% {
        opacity: 0;
      }
    }

    .font {
      animation: font 7s step-end infinite;
    }

      @keyframes font {
          0% {
            font-weight: 100;
            color: var(--color-primary);
            filter: blur(3px);
          }

          20% {
            font-weight: 500;
            color: var(--color-light);
            filter: blur(0);
          }

          50% {
            font-weight: 300;
            color: var(--color-accent-2);
            filter: blur(2px);
          }

          60% {
            font-weight: 700;
            color: var(--color-accent-1);
            filter: blur(0);
          }

          90% {
            font-weight: 500;
            color: var(--color-primary);
            filter: blur(6px);
          }
        }

        .glitch {
          animation: paths 3s step-end infinite;
        }

        .glitch::before {
          animation: paths 5s step-end infinite, opacity 5s step-end infinite,
            font 8s step-end infinite, movement 10s step-end infinite;
        }

        .glitch::after {
          animation: paths 5s step-end infinite, opacity 5s step-end infinite,
            font 7s step-end infinite, movement 8s step-end infinite;
        }

        .glitch-slow {
          animation: paths 10s step-end infinite;
        }

        .glitch-slow::before {
          animation: paths 5s step-end infinite, opacity 5s step-end infinite,
            font 8s step-end infinite, movement 10s step-end infinite;
        }

        .glitch-slow::after {
          animation: paths 5s step-end infinite, opacity 5s step-end infinite,
            font 7s step-end infinite, movement 8s step-end infinite;
        }

        ::-webkit-scrollbar {
          width: var(--size-lg);
        }

        ::-webkit-scrollbar-track {
          background: var(--color-accent-1);
        }

        ::-webkit-scrollbar-thumb {
          background: var(--color-primary);
          border-radius: 0px;
          min-height: var(--size-xxl);
          z-index: 100;
        }

        ::-webkit-scrollbar-track:active {
          background: var(--color-secondary);
        }

        ::-webkit-scrollbar-track:hover {
          background: var(--color-secondary);
        }

        ::-webkit-scrollbar-thumb:active {
          box-shadow: 1px 3px var(--text-color);
        }

        ::-webkit-scrollbar-thumb:hover {
          box-shadow: 1px 3px var(--color-text-main);
        }

        body {
          margin: 0;
          padding: 0;
          height: 100%;
          width: 100%;
          overflow: hidden;
        }

        h1 {
          font-size: var(--size-md);
          text-align: center;
          color: transparent;
          text-shadow: var(--text-shadow-highlight);
          font-weight: bold;
        }

        h3 {
          margin-top: 0;
          margin-bottom: var(--size-xs);
          color: var(--color-primary);
        }

        .use-gpu-rendering {
          -webkit-transform: translate3d(0, 0, 0);
          -moz-transform: translate3d(0, 0, 0);
          -ms-transform: translate3d(0, 0, 0);
          transform: translate3d(0, 0, 0);
          -webkit-backface-visibility: hidden;
          -moz-backface-visibility: hidden;
          -ms-backface-visibility: hidden;
          backface-visibility: hidden;
          -webkit-perspective: 1000;
          -moz-perspective: 1000;
          -ms-perspective: 1000;
          perspective: 1000;
          -webkit-transform: translateZ(0);
          -moz-transform: translateZ(0);
          -ms-transform: translateZ(0);
          -o-transform: translateZ(0);
        }

        .modal {
          display: block;
          flex-direction: column;
          position: absolute;
          z-index: 1;
          left: 0;
          top: 0;
          width: 50%;
          height: 50%;
          overflow: auto;
          background-color: var(--color-light);
          background: var(--color-light);
          border: var(--color-primary) 3px solid;
          resize: both;
          box-shadow: var(--box-shadow-highlight);
          z-index: 15;
          overflow-x: hidden;
          overflow-y: hidden;
        }

        .modal-window-title {
          cursor: move;
          height: var(--size-lg);
          font-size: var(--size-md);
          display: flex;
          align-items: center;
          background-color: var(--color-accent-1);
          color: var(--color-text-main);
          justify-content: space-around;
          border-bottom: var(--color-primary) 3px solid;
          box-shadow: var(--box-shadow-highlight);
          width: 100%;
        }

        .modal-window-title:hover {
          background-color: var(--color-secondary);
        }

        @media screen and (max-width: 1100px) {
          .modal-window-title {
            height: fit-content;
            font-size: var(--size-xs);
          }

          .modal-window-title-button {
            margin: var(--size-xxs);
            height: var(--size-lg);
          }
        }

        .text-link-button {
          color: var(--text-color);
          text-decoration: none;
          cursor: pointer;
          transition: text-indent 0.5s;
          font-size: var(--size-sm);
          background: transparent;
          border: 0;
        }

        @media screen and (max-width: 600px) {
          .text-link-button {
            font-size: var(--size-sm);
          }
        }

        .text-link-button--selected {
          color: var(--color-primary);
          font-weight: bolder;
        }

        .text-link-button:hover {
          color: var(--color-primary);
          text-shadow: var(--text-shadow-highlight);
        }

        .modal-content {
          flex-grow: 1;
          height: 100%;
          overflow: hidden;
          overflow-y: hidden;
          background-color: var(--color-light);
          background: var(--color-light);
        }

        iframe {
          width: 100%;
          height: 100%;
          background: var(--color-light);
        }

        .title-content {
          position: absolute;
          height: var(--size-lg);
          width: 100%;
          display: flex;
          flex-direction: row;
          justify-content: flex-start;
          align-items: baseline;
          padding-left: var(--top-level-padding-side);
          background: var(--color-accent-1);
          width: calc(100vw - var(--top-level-padding-side) - var(--size-lg));
          z-index: 10;
        }

        .title-content:hover {
          background: var(--color-secondary);
        }

        .title-content h1 {
          margin: 0 var(--size-xs) 0 0;
        }

        .main-content {
          background-image: var(--backgound-linear-gradient);
          padding-left: var(--top-level-padding-side);
          padding-right: var(--top-level-padding-side);
          height: calc(100vh - var(--size-lg));
          max-height: calc(100vh - var(--size-lg));
          overflow-y: scroll;
          padding-top: var(--size-lg);
        }

        .story-container {
          margin-top: var(--size-xxs);
          margin-bottom: var(--size-xxs);
        }

        .story-container span {
          color: var(--color-text-main);
          font-size: var(--size-sm);
          cursor: pointer;
        }

        .story-container span:hover {
          color: transparent;
          font-weight: bold;
          text-indent: 5px;
          transition: text-indent 0.5s;
          text-shadow: var(--text-shadow-highlight);
        }

        .story-container span:hover::before {
          display: inline-block;
          content: "->";
        }

        .settings-content {
          display: flex;
          flex-direction: column;
          align-items: flex-start;
          justify-content: left;
          padding-top: var(--size-xxs);
        }

        .setting-element {
          display: flex;
          flex-direction: row;
          align-items: center;
          justify-content: space-between;
          padding: var(--size-xxs);
        }

        .setting-element:hover {
          background: var(--color-secondary);
        }

        .setting-name {
          min-width: var(--size-xxl);
        }

        .setting-new-value-input {
          background: transparent;
          border: 0;
        }

        .setting-apply-button, .setting-reset-button {
          height: var(--size-md);
        }

        .settings-content button {
          margin-left: var(--size-xs);
        }

        .theme-buttons-row button {
          margin-bottom: var(--size-xs);
          height: var(--size-md);
        }
  </style>

  <!-- Constants -->
  <script type="text/javascript">
    const MILLISECONDS_IN_SECOND = 1_000;
    const TOTAL_ANIMATION_STRINGS = 100;
    const LOADING_STRING_MIN_LENGTH = 5;
    const LOADING_STRING_MAX_LENGTH = 80;
    const MOBILE_DEVICE_MAX_WIDTH = 600;
    const LOADING_STORY_ANIMATION_REFRESH_INTERVAL_MINIMUM = 250;
    const LOADING_STORY_ANIMATION_REFRESH_INTERVAL_MAXIMUM = 2_000;
    const LOADING_ANIMATION_NUMBER_OF_ROWS = 50;
    const ANIMATION_CHARACTERS_STRING =
      "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()_+=-[]{}|;:,.<>?♥♦♣♠•◘○◆☻☺♂♀♪♫☼►◄↕‼¶§▬↨↑↓→←∟↔▲▼ァアィイゥウェエォオカガキギクゲゴサザシジスゼソゾタダチヂッツヅテデトドナニヌネノハバパヒビピフブプヘベペホボポマミムメモャユョヨラリルレロヮワヰヱヲン々〆〤￥「」『』【】〒〓─━│┃┄┅┆┇┈┉┊┋┌┍┎┏┐┑┒┓└┕┖┗┘┙┚┛├┝┞┟┠┡┢┣┤┥┦┧┨┩┪┫┬┭┮┯┰┱┲┳┴┵┶┷┸┹┺┻┼┽┾┿╀╁╂╃╄╅╆╇╈╉╊╋╌╍╎╏═║╒╓╔╕╖╗╘╙╚╛╜╝╞╟╠╡╢╣╤╥╦╧╨╩╪╫╬§¶☊☋☌☍ΑΒΓΔΕΖΗΘΙΚΛΜΝΞΟΠΡΣΤΥΦΧΨΩαβγδεζηθικλμνξοπρςστυφχψω←↑→↓↔↕↖↗↘↙↚↛↜↝↞↟↠↡↢↣↤↥↦↧↨↩↪↫↬↭↮↯↰↱↲↳↴↵↶↷↸↹↺↻↼↽↾↿⇀⇁⇂⇃⇄⇅⇆⇇⇈⇉⇊⇋⇌⇍⇎⇏⇐⇑⇒⇓⇔⇕⇖⇗⇘⇙⇚⇛⇜⇝⇞⇟⇠⇡⇢⇣⇤⇥⇦⇧⇨⇩⇪⌨";
    // TODO: add more of these incase of future alteration
    const TWITTER_SHARE_URL =
      "https://twitter.com/intent/tweet?text=Check%20out%20this%20awesome%20content&url=";
  </script>

  <!-- API -->
  <script type="text/javascript">
    const HACKER_NEWS_API_URL = "https://hacker-news.firebaseio.com/v0/";
    const HACKER_NEWS_USER_PROFILE_URL =
      "https://news.ycombinator.com/user?id=";

    // TODO: remove coupling with DOM state
    async function getRequestWithLoadingAnimation(url) {
      showLoadingAnimation();
      let response;
      try {
        response = await fetch(url);
        if (!response.ok)
          throw new Error(`HTTP error! status: ${response.status}`);
      } catch (error) {
        console.error(error);
        hideLoadingAnimation();
        throw error;
      } finally {
        hideLoadingAnimation();
      }

      return response.json();
    }

    const itemCache = new Map();

    const API = {
      topStories: () =>
        getRequestWithLoadingAnimation(`${HACKER_NEWS_API_URL}topstories.json`),
      newStories: () =>
        getRequestWithLoadingAnimation(`${HACKER_NEWS_API_URL}newstories.json`),
      bestStories: () =>
        getRequestWithLoadingAnimation(
          `${HACKER_NEWS_API_URL}beststories.json`
        ),
      askStories: () =>
        getRequestWithLoadingAnimation(`${HACKER_NEWS_API_URL}askstories.json`),
      showStories: () =>
        getRequestWithLoadingAnimation(
          `${HACKER_NEWS_API_URL}showstories.json`
        ),
      jobStories: () =>
        getRequestWithLoadingAnimation(`${HACKER_NEWS_API_URL}jobstories.json`),
      /**
     * Stories, comments, jobs, Ask HNs and even polls are just items. They're
     * identified by their ids, which are unique integers, and live under
     * /v0/item/<id>.
     *
     * All items have some of the following properties:
          [Field]     [Description]
          id	        The item's unique id.
          deleted	    true if the item is deleted.
          type    	The type of item. One of "job", "story", "comment", "poll", or "pollopt".
          by	        The username of the item's author.
          time	    Creation date of the item, in Unix Time.
          text    	The comment, story or poll text. HTML.
          dead	    true if the item is dead.
          parent  	The comment's parent: either another comment or the relevant story.
          poll	    The pollopt's associated poll.
          kids	    The ids of the item's comments, in ranked display order.
          url     	The URL of the story.
          score	    The story's score, or the votes for a pollopt.
          title	    The title of the story, poll or job. HTML.
          parts	    A list of related pollopts, in display order.
          descendants	In the case of stories or polls, the total comment count.
      *
      * For example, a story: https://hacker-news.firebaseio.com/v0/item/8863.json?print=pretty
      *
      *
      * @param {number} id
      *
      */
      item: (id) => {
        if (itemCache.has(id)) return Promise.resolve(itemCache.get(id));
        return fetch(`${HACKER_NEWS_API_URL}item/${id}.json`)
          .then((response) => response.json())
          .then((item) => {
            itemCache.set(id, item);
            return item;
          })
          .catch((error) => console.error(error));
      },
      user: (id) =>
        getRequestWithLoadingAnimation(`${HACKER_NEWS_API_URL}user/${id}.json`),
    };
  </script>

  <!-- Utils -->
  <script type="text/javascript">
    /**
     * Loop utility, does `callback` `times` times
     * @param {number} times
     * @param {function} callback
     * @returns {void}
     */
    const loop = (times, callback) => {
      for (let i = 0; i < times; i++) {
        callback(i);
      }
    };

    /**
     * Wait utility, returns a promise that resolves after `timeInMs` milliseconds
     * @param {number} timeInMs
     * @returns {Promise<void>}
     */
    function wait(timeInMs) {
      return new Promise((resolve) => {
        setTimeout(resolve, timeInMs);
      });
    }

    /**
     * Returns a random number between `min` and `max`
     * @param {number} min
     * @param {number} max
     * @returns {number}
     */
    const getRandomNumberBetween = (min, max) =>
      Math.floor(Math.random() * (max - min + 1) + min);

    function getHackerNewsPosterURLFromId(id) {
      return `${HACKER_NEWS_USER_PROFILE_URL}${id}`;
    }

    /**
     * Utility for handling state and side effects, listening for changes
     * @param {any} initialState
     * @param {function} sideEffect
     * @returns {object}
     */
    function reactive(initialState, sideEffect) {
      let state = initialState;
      const current = () => state;

      const update = (newState) => {
        state = newState;
        sideEffect(state);
      };

      const observers = [];
      const subscribe = (observer) => observers.push(observer);

      const notify = () => {
        observers.forEach((observer) => observer(state));
      };

      return {
        current,
        update,
        subscribe,
        notify,
      };
    }

    function shareOnTwitter(story) {
      window.open(
        `${TWITTER_SHARE_URL}${story.url || window.location.href}`,
        "_blank"
      );
    }

    function shareStory(story) {
      if (!!navigator.canShare && navigator.canShare() && !!navigator.share) {
        navigator
          .share({
            title: story.title,
            text: story.text || story.title,
            url: story.url || window.location.href,
          })
          .then(() => console.log("Successful share"))
          .catch((error) => shareOnTwitter(story));
      } else {
        shareOnTwitter(story);
      }
    }

    function downloadJSONAsFile(json) {
      const data = JSON.stringify(json, null, 2);
      const blob = new Blob([data], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "data.json";
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>

  <!-- Favorites -->
  <script>
    const getFavorites = () =>
      JSON.parse(localStorage.getItem("favorites")) || [];

    const setFavorites = (favorites) =>
      localStorage.setItem("favorites", JSON.stringify(favorites));

    function isStoryFavorited(storyId) {
      return getFavorites().includes(storyId);
    }

    function renderFavorites() {
      const favoriteStories = document.querySelector("#favorites-outlet");
      favoriteStories.innerHTML = "";
      getFavorites().forEach((storyId) => {
        favoriteStories.appendChild(new StoryListElement(storyId));
      });
      return favoriteStories;
    }

    function favoriteStory(storyId) {
      const favorites = getFavorites();
      if (favorites.includes(storyId)) return;
      favorites.push(storyId);
      setFavorites(favorites);
      renderFavorites();
    }

    function unfavoriteStory(storyId) {
      setFavorites(getFavorites().filter((id) => id !== storyId));
      renderFavorites();
    }

    function clearAllFavorites() {
      setFavorites([]);
      renderFavorites();
    }

    const downloadFavorites = () => downloadJSONAsFile(getFavorites());

    const attachFavoritesListeners = () => {
      document
        .querySelector("#clear-all-favorites-button")
        .addEventListener("click", clearAllFavorites);

      document
        .querySelector("#download-favorites-button")
        .addEventListener("click", downloadFavorites);
    };
  </script>

  <!-- Settings -->
  <script type="text/javascript">
    const SETTINGS = {
      COLOR_PRIMARY: "--color-primary",
      COLOR_SECONDARY: "--color-secondary",
      COLOR_ACCENT_1: "--color-accent-1",
      COLOR_ACCENT_2: "--color-accent-2",
      COLOR_DARK: "--color-dark",
      COLOR_LIGHT: "--color-light",
      COLOR_TEXT_MAIN: "--color-text-main",
    };

    const SETTING__DEFAULT_VALUES = {
      [SETTINGS.COLOR_PRIMARY]: "#e30613",
      [SETTINGS.COLOR_SECONDARY]: "#ffed00",
      [SETTINGS.COLOR_ACCENT_1]: "#f6d365",
      [SETTINGS.COLOR_ACCENT_2]: "#fda085",
      [SETTINGS.COLOR_DARK]: "#3c3c3c",
      [SETTINGS.COLOR_LIGHT]: "#FFFFFF",
      [SETTINGS.COLOR_TEXT_MAIN]: "#2f4f4f",
    };

    const themes = {
      hacker: {
        "--color-primary": "#00ff00", // Neon Green
        "--color-secondary": "#ff00ff", // Neon Purple
        "--color-accent-1": "#ff0000", // Bright Red
        "--color-accent-2": "#0000ff", // Bright Blue
        "--color-dark": "#000000", // Black
        "--color-light": "#ffffff", // White
        "--color-text-main": "#00ff00", // Neon Green
      },
      l33t: {
        "--color-primary": "#08fdd8", // Aqua
        "--color-secondary": "#f800ff", // Magenta
        "--color-accent-1": "#1b1b1b", // Dark Gray
        "--color-accent-2": "#333333", // Medium Gray
        "--color-dark": "#080808", // Very Dark Gray
        "--color-light": "#f0f0f0", // Off White
        "--color-text-main": "#0033FF", // Aqua
      },
      "dream-pop": {
        "--color-primary": "#ff77aa", // Pink
        "--color-secondary": "#cc99ff", // Purple
        "--color-accent-1": "#ff99ee", // Light Pink
        "--color-accent-2": "#d1b3ff", // Light Purple
        "--color-dark": "#342a4e", // Dark Purple
        "--color-light": "#fff0f5", // Lavender Blush
        "--color-text-main": "##808080", // Gray
      },
      "solar-flare": {
        "--color-primary": "#ffffff", // White
        "--color-secondary": "#000000", // Black
        "--color-accent-1": "#ff0000", // Red
        "--color-accent-2": "#ffff00", // Yellow
        "--color-dark": "#000000", // Black
        "--color-light": "#ffffff", // White
        "--color-text-main": "#282828", // White
      },
      hippie: {
        "--color-primary": "#fabd2f", // Yellow
        "--color-secondary": "#d3869b", // Pink
        "--color-accent-1": "#83a598", // Aqua
        "--color-accent-2": "#b8bb26", // Green
        "--color-dark": "#282828", // Dark Gray
        "--color-light": "#ebdbb2", // Light Gray
        "--color-text-main": "#fabd2f", // Yellow
      },
    };

    const applyTheme = (theme) => {
      Object.entries(theme).forEach(([key, value]) => {
        setCSSVariable(key, value);
        saveSettingToLocalStorage(key, value);
        updateSettingInputWithCurrentValue(key);
      });
    };

    const convertToHexString = (rgba) => {
      const [r, g, b, a] = rgba
        .substring(5, rgba.length - 1)
        .replace(/ /g, "")
        .split(",");
      return `#${parseInt(r).toString(16)}${parseInt(g).toString(16)}${parseInt(
        b
      ).toString(16)}`;
    };

    const asColorSelectorInputValue = (string) => {
      if (string.startsWith("#")) {
        return string;
      }
      return convertToHexString(string);
    };

    const getCSSVariable = (variable) =>
      getComputedStyle(document.documentElement).getPropertyValue(variable);

    const setCSSVariable = (variable, value) =>
      document.documentElement.style.setProperty(variable, value);

    const loadSettingsFromLocalStorage = () => {
      Object.entries(SETTINGS).forEach(([key, value]) => {
        const storedValue = localStorage.getItem(value);
        if (storedValue) {
          setCSSVariable(value, storedValue);
        }
      });
    };

    const saveSettingToLocalStorage = (setting, value) => {
      localStorage.setItem(setting, value);
    };

    const changeSetting = (setting, value) => {
      setCSSVariable(setting, value);
      saveSettingToLocalStorage(setting, value);
    };

    const updateSettingInputWithCurrentValue = (setting) => {
      document.querySelector(`#setting-input${setting}`).value =
        asColorSelectorInputValue(getCSSVariable(setting));
    };

    const resetSetting = (setting) => {
      changeSetting(setting, SETTING__DEFAULT_VALUES[setting]);
      updateSettingInputWithCurrentValue(setting);
    };

    const downloadCurrentColorTheme = () => {
      const theme = {};
      Object.entries(SETTINGS).forEach(([key, value]) => {
        theme[value] = getCSSVariable(value);
      });
      downloadJSONAsFile(theme);
    };

    const initializeSettings = () => {
      Object.entries(SETTINGS).forEach(([key, value]) => {
        try {
          const storedValue = localStorage.getItem(value);
          if (!storedValue) {
            setCSSVariable(value, SETTING__DEFAULT_VALUES[value]);
            saveSettingToLocalStorage(value, SETTING__DEFAULT_VALUES[value]);
          }

          updateSettingInputWithCurrentValue(value);

          document
            .querySelector(`#apply-setting${value}`)
            .addEventListener("click", () => {
              changeSetting(
                value,
                document.querySelector(`#setting-input${value}`).value
              );
            });

          document
            .querySelector(`#reset-setting${value}`)
            .addEventListener("click", () => resetSetting(value));
        } catch (e) {
          console.error(e);
          resetSetting(value);
        }
      });

      document
        .querySelector("#download-theme-button")
        .addEventListener("click", downloadCurrentColorTheme);

      document
        .querySelector("#button-theme-default")
        .addEventListener("click", () => applyTheme(SETTING__DEFAULT_VALUES));

      document
        .querySelector("#button-theme-hacker")
        .addEventListener("click", () => applyTheme(themes.hacker));

      document
        .querySelector("#button-theme-l33t")
        .addEventListener("click", () => applyTheme(themes.l33t));

      document
        .querySelector("#button-theme-dream-pop")
        .addEventListener("click", () => applyTheme(themes["dream-pop"]));

      document
        .querySelector("#button-theme-solar-flare")
        .addEventListener("click", () => applyTheme(themes["solar-flare"]));

      document
        .querySelector("#button-theme-hippie")
        .addEventListener("click", () => applyTheme(themes.hippie));
    };
  </script>

  <!-- Navigation -->
  <script type="text/javascript">
    /**
     * Navigation options
     */
    const NAVIGATION_OPTIONS = {
      TOP: "top",
      NEW: "new",
      BEST: "best",
      ASK: "ask",
      SHOW: "show",
      JOB: "job",
      FAVORITES: "favorites",
      SETTINGS: "settings",
    };

    /**
     * Updates the DOM for the selected section
     * @param {string} option
     * @returns {void}
     */
    function updateDOMForNavigationOption(option) {
      Object.entries(NAVIGATION_OPTIONS).forEach(([key, value]) => {
        if (value === option) {
          document
            .querySelector(`#nav-button-${value}`)
            .classList.add("text-link-button--selected");
        } else {
          document
            .querySelector(`#nav-button-${value}`)
            .classList.remove("text-link-button--selected");
        }
        document.querySelector(`#${value}-outlet`).style.display =
          value === option ? "block" : "none";
      });
    }

    /**
     * Attaches click listeners to navigation buttons
     * @returns {void}
     */
    function attachNavigationButtonClickListeners() {
      Object.entries(NAVIGATION_OPTIONS).forEach(([key, value]) => {
        document
          .querySelector(`#nav-button-${value}`)
          .addEventListener("click", () => {
            navigationState.update(value);
          });
      });
    }

    function applyInitialNavigationState() {
      const currentURL = new URL(window.location.href);
      const currentPath = currentURL.pathname.split("/").pop();
      if (Object.values(NAVIGATION_OPTIONS).includes(currentPath)) {
        navigationState.update(currentPath);
      } else {
        navigationState.update(NAVIGATION_OPTIONS.TOP);
      }
    }

    function applyCurrentNavigationStateToURL() {
      const currentURL = new URL(window.location.href);
      const currentPath = currentURL.pathname.split("/").pop();
      currentURL.pathname = `/${navigationState.current()}`;
      window.history.pushState({}, "", currentURL);
    }
  </script>

  <!-- Animations -->
  <script type="text/javascript">
    /**
     * Makes a modal draggable
     * @param {HTMLElement} element
     * @returns {void}
     */
    function makeModalDragable(element) {
      let pos1 = 0,
        pos2 = 0,
        pos3 = 0,
        pos4 = 0;

      // Only drag from the title bar
      element.querySelector(".modal-window-title").onmousedown = dragMouseDown;

      function dragMouseDown(e) {
        e = e || window.event;
        e.preventDefault();
        // Get the mouse cursor position at startup:
        pos3 = e.clientX;
        pos4 = e.clientY;
        document.onmouseup = closeDragElement;
        // Call a function whenever the cursor moves:
        document.onmousemove = elementDrag;
      }

      function elementDrag(e) {
        e = e || window.event;
        e.preventDefault();
        // Calculate the new cursor position:
        pos1 = pos3 - e.clientX;
        pos2 = pos4 - e.clientY;
        pos3 = e.clientX;
        pos4 = e.clientY;
        element.style.top = element.offsetTop - pos2 + "px";
        element.style.left = element.offsetLeft - pos1 + "px";
      }

      function closeDragElement() {
        // Stop moving when mouse button is released:
        document.onmouseup = null;
        document.onmousemove = null;
      }
    }

    /**
     * Scrolls to the top of the page
     * @returns {void}
     */
    function scrollToTop() {
      window.scrollTo(0, 0);
    }

    /**
     * Shows the loading animation
     * @returns {void}
     */
    function showLoadingAnimation() {
      scrollToTop();
      document.querySelector("#loading-outlet").style.display = "block";
    }

    /**
     * Hides the loading animation
     * @returns {void}
     */
    function hideLoadingAnimation() {
      scrollToTop();
      document.querySelector("#loading-outlet").style.display = "none";
    }

    /**
     * Returns a random loading string
     * @returns {string}
     */
    const getRandomLoadingString = () =>
      loadingStrings[Math.floor(Math.random() * TOTAL_ANIMATION_STRINGS)];

    /**
     * Initializes the loading animation
     * @returns {void}
     */
    function initializeLoadingAnimation() {
      loop(LOADING_ANIMATION_NUMBER_OF_ROWS, (i) => {
        document
          .querySelector("#loading-outlet")
          .appendChild(new LoadingStoryElement());
      });
    }
  </script>

  <!-- Custom Elements -->
  <script type="text/javascript">
    /**
     * Cache of callbacks to load stories into elements so that they are only
     * loaded as brought into view.
     */
    const storyElementLoadingCallbacks = {};

    /**
     * Story list element for a hacker news story
     * @param {number} storyId
     * @param {boolean} loadContentImmediately
     * @returns {HTMLElement}
     */
    function StoryListElement(storyId, loadContentImmediately = false) {
      // Create html element for story
      const storyContainer = document.createElement("div");
      storyContainer.id = storyId;
      storyContainer.classList.add("story-container");

      // Assign random string for loading effect
      storyContainer.innerHTML = `<span>${getRandomLoadingString()}}</span>`;

      const loadStory = () => {
        API.item(storyId).then(async (story) => {
          storyContainer.firstChild.textContent = story.title;
          storyContainer.addEventListener("click", () => {
            launchStoryModal(story);
          });
        });
      };

      if (loadContentImmediately) loadStory();

      storyElementLoadingCallbacks[storyId] = loadStory;

      return storyContainer;
    }

    /**
     * Modal that shows iframe of hacker news story and perform other actions
     * regarding story.
     * @param {object} story
     * @returns {HTMLElement}
     */
    function StoryModal(story) {
      const modal = document.createElement("div");
      modal.classList.add("modal");
      modal.classList.add("use-gpu-rendering");

      modal.innerHTML = `<div class="modal-window-title" role="dialog" aria-modal="true">
        <button id="close-button-${story.id}" class="modal-window-title-button">
          Close
        </button>

        <button id="open-link-${story.id}" class="modal-window-title-button">
          NewTab
        </button>

        <button id="poster-name-${story.id}" class="modal-window-title-button">
         ViewPrfl
        </button>

        <button id="share-story-${story.id}" class="modal-window-title-button">
          Share
        </button>

        ${
          isStoryFavorited(story.id)
            ? `<button id="favorite-story-button-${story.id}" class="modal-window-title-button">💘</button>`
            : `<button id="favorite-story-button-${story.id}" class="modal-window-title-button">💖</button>`
        }

      </div>
      <div class="modal-content">
        <iframe id="story-iframe-${story.id}" src="${story.url}"></iframe>
      </div>`;

      if (window.innerWidth < MOBILE_DEVICE_MAX_WIDTH) {
        modal.style.width = "90%";
        modal.style.height = "99%";
      } else {
        modal.style.width = "50%";
        modal.style.height = "50%";
      }

      if (window.innerWidth < MOBILE_DEVICE_MAX_WIDTH) {
        modal.style.top = "0";
        modal.style.left = "0";
      } else {
        modal.style.top = "25%";
        modal.style.left = "25%";
      }

      modal
        .querySelector(`#open-link-${story.id}`)
        .addEventListener("click", () => window.open(story.url, "_blank"));

      modal
        .querySelector(`#poster-name-${story.id}`)
        .addEventListener("click", () =>
          window.open(getHackerNewsPosterURLFromId(story.by), "_blank")
        );

      modal
        .querySelector(`#close-button-${story.id}`)
        .addEventListener("click", () => modal.remove());

      modal
        .querySelector(`#share-story-${story.id}`)
        .addEventListener("click", () => shareStory(story));

      const updateFavoriteButtonState = () => {
        if (isStoryFavorited(story.id)) {
          modal.querySelector(
            `#favorite-story-button-${story.id}`
          ).textContent = "💘";
        } else {
          modal.querySelector(
            `#favorite-story-button-${story.id}`
          ).textContent = "💖";
        }
      };

      modal
        .querySelector(`#favorite-story-button-${story.id}`)
        .addEventListener("click", () => {
          if (isStoryFavorited(story.id)) {
            unfavoriteStory(story.id);
          } else {
            favoriteStory(story.id);
          }
          updateFavoriteButtonState();
        });

      return modal;
    }

    /**
     * Loading version of normal story element that produces text glitch effect
     * @returns {HTMLElement}
     */
    function LoadingStoryElement() {
      const loadingContainer = document.createElement("div");
      loadingContainer.classList.add("story-container");

      const animationRender = () =>
        (loadingContainer.innerHTML = `<span>${generateLoadingString(
          getRandomNumberBetween(
            LOADING_STRING_MIN_LENGTH,
            LOADING_STRING_MAX_LENGTH
          )
        )}</span>`);

      const animationSpeed = getRandomNumberBetween(
        LOADING_STORY_ANIMATION_REFRESH_INTERVAL_MINIMUM,
        LOADING_STORY_ANIMATION_REFRESH_INTERVAL_MAXIMUM
      );

      const animationUpdateInterval = setInterval(
        animationRender,
        animationSpeed
      );

      // Initial render
      animationRender();

      // Clear interval whenever the element is removed from the DOM
      loadingContainer.addEventListener("DOMNodeRemoved", () =>
        clearInterval(animationRender)
      );

      return loadingContainer;
    }
  </script>

  <script type="text/javascript">
    /**
     * Generates a random loading string with length `length` from
     * `ANIMATION_CHARACTERS_STRING` character set.
     * @param {number} length
     * @returns {string}
     */
    function generateLoadingString(length) {
      let result = "";
      for (let i = 0; i < length; i++) {
        result += ANIMATION_CHARACTERS_STRING.charAt(
          Math.floor(Math.random() * ANIMATION_CHARACTERS_STRING.length)
        );
      }
      return result;
    }

    /**
     * Precomputes loading strings for the loading animation
     * @returns {Promise<string[]>}
     */
    async function precomputeLoadingStrings() {
      const loadingStrings = [];
      for (let i = 0; i < TOTAL_ANIMATION_STRINGS; i++) {
        loadingStrings.push(
          generateLoadingString(
            Math.random() *
              (LOADING_STRING_MAX_LENGTH - LOADING_STRING_MIN_LENGTH) +
              LOADING_STRING_MIN_LENGTH
          )
        );
      }
      return loadingStrings;
    }

    /*
     * Precomputed loading strings
     */
    let loadingStrings = ["loading..."];
    // Assign precomputed loading strings to `loadingStrings` when ready
    precomputeLoadingStrings().then((strings) => {
      loadingStrings = strings;
    });

    /**
     * DOM elements for top stories list
     */
    const topStoryElements = reactive([], (newState) => {
      document.querySelector("#top-outlet").innerHTML = "";
      newState.forEach((storyElement) => {
        document.querySelector("#top-outlet").appendChild(storyElement);
      });
      startStoryIntersectionObservers();
    });

    /**
     * Ids corresponding to top stories. Will recompute `topStoryElements` in
     * memory whenever it changes.
     */
    const topStoryIds = reactive([], (newState) => {
      topStoryElements.update(
        newState.map((storyId) => new StoryListElement(storyId))
      );
    });

    /**
     * DOM elements for stories sorted by new
     */
    const newStoryElements = reactive([], (newState) => {
      document.querySelector("#new-outlet").innerHTML = "";
      newState.forEach((storyElement) => {
        document.querySelector("#new-outlet").appendChild(storyElement);
      });
      startStoryIntersectionObservers();
    });

    /**
     * Ids corresponding to new stories. Will recompute `newStoryElements` in
     * memory whenever it changes.
     */
    const newStoryIds = reactive([], (newState) => {
      newStoryElements.update(
        newState.map((storyId) => new StoryListElement(storyId))
      );
    });

    /**
     * DOM elements for stories sorted by best
     */
    const bestStoryElements = reactive([], (newState) => {
      document.querySelector("#best-outlet").innerHTML = "";
      newState.forEach((storyElement) => {
        document.querySelector("#best-outlet").appendChild(storyElement);
      });
      startStoryIntersectionObservers();
    });

    /**
     * Ids corresponding to best stories. Will recompute `bestStoryElements` in
     * memory whenever it changes.
     */
    const bestStoryIds = reactive([], (newState) => {
      bestStoryElements.update(
        newState.map((storyId) => new StoryListElement(storyId))
      );
    });

    /**
     * DOM elements for stories sorted by ask
     */
    const askStoryElements = reactive([], (newState) => {
      document.querySelector("#ask-outlet").innerHTML = "";
      newState.forEach((storyElement) => {
        document.querySelector("#ask-outlet").appendChild(storyElement);
      });
      startStoryIntersectionObservers();
    });

    /**
     * Ids corresponding to ask stories. Will recompute `askStoryElements` in
     * memory whenever it changes.
     */
    const askStoryIds = reactive([], (newState) => {
      askStoryElements.update(
        newState.map((storyId) => new StoryListElement(storyId))
      );
    });

    /**
     * DOM elements for stories sorted by show
     */
    const showStoryElements = reactive([], (newState) => {
      document.querySelector("#show-outlet").innerHTML = "";
      newState.forEach((storyElement) => {
        document.querySelector("#show-outlet").appendChild(storyElement);
      });
      startStoryIntersectionObservers();
    });

    /**
     * Ids corresponding to show stories. Will recompute `showStoryElements` in
     * memory whenever it changes.
     */
    const showStoryIds = reactive([], (newState) => {
      showStoryElements.update(
        newState.map((storyId) => new StoryListElement(storyId))
      );
    });

    /**
     * DOM elements for stories sorted by job
     */
    const jobStoryElements = reactive([], (newState) => {
      document.querySelector("#job-outlet").innerHTML = "";
      newState.forEach((storyElement) => {
        document.querySelector("#job-outlet").appendChild(storyElement);
      });
      startStoryIntersectionObservers();
    });

    /**
     * Ids corresponding to job stories. Will recompute `jobStoryElements` in
     * memory whenever it changes.
     */
    const jobStoryIds = reactive([], (newState) => {
      jobStoryElements.update(
        newState.map((storyId) => new StoryListElement(storyId))
      );
    });

    /**
     * DOM elements for stories marked as favorites
     */
    const favorites = reactive([], (newState) => {
      console.log("Favorites:", newState);
    });

    const onNavigationChange = (newState) => {
      updateDOMForNavigationOption(newState);
      applyCurrentNavigationStateToURL();
      scrollToTop();

      switch (newState) {
        case NAVIGATION_OPTIONS.TOP:
          console.log("inside switch");
          API.topStories().then((storyIds) => {
            topStoryIds.update(storyIds);
          });
          break;
        case NAVIGATION_OPTIONS.NEW:
          API.newStories().then((storyIds) => {
            newStoryIds.update(storyIds);
          });
          break;
        case NAVIGATION_OPTIONS.BEST:
          API.bestStories().then((storyIds) => {
            bestStoryIds.update(storyIds);
          });
          break;
        case NAVIGATION_OPTIONS.ASK:
          API.askStories().then((storyIds) => {
            askStoryIds.update(storyIds);
          });
          break;
        case NAVIGATION_OPTIONS.SHOW:
          API.showStories().then((storyIds) => {
            showStoryIds.update(storyIds);
          });
          break;
        case NAVIGATION_OPTIONS.JOB:
          API.jobStories().then((storyIds) => {
            jobStoryIds.update(storyIds);
          });
          break;
        case NAVIGATION_OPTIONS.FAVORITES:
          renderFavorites();
          startStoryIntersectionObservers();
          break;
        default:
          console.error("Invalid navigation option");
      }
    };

    /**
     * Reactive store for section selected to rended. Will change the section.
     * This also triggers recomputation of all cascading sections from their own
     * respective reactive stores.
     *
     * @param {string} initialState
     * @param {function} sideEffect
     */
    const navigationState = reactive(
      NAVIGATION_OPTIONS.TOP,
      onNavigationChange
    );

    /**
     * Launches a modal for a story
     * @param {object} story
     * @returns {void}
     */
    function launchStoryModal(story) {
      const node = document.body.appendChild(new StoryModal(story));
      // TODO: find a way to make modal dragable in constructor
      makeModalDragable(node);
    }

    /**
     * Starts intersection observers for story elements in view. These stories
     * will only load their data as they come into view.
     * @returns {void}
     */
    function startStoryIntersectionObservers() {
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              if (storyElementLoadingCallbacks[entry.target.id])
                storyElementLoadingCallbacks[entry.target.id]();

              observer.unobserve(entry.target);
            }
          });
        },
        { rootMargin: "0px 0px 100px 0px" }
      );

      document.querySelectorAll(".story-container").forEach((story) => {
        observer.observe(story);
      });
    }

    /**
     * Launches root logic of page
     * @returns {void}
     */
    async function main() {
      initializeLoadingAnimation();
      attachNavigationButtonClickListeners();
      loadSettingsFromLocalStorage();
      initializeSettings();
      renderFavorites();
      attachFavoritesListeners();
      // This triggers root propagation of state changes
      navigationState.update(NAVIGATION_OPTIONS.TOP);
    }

    // Call main when other data loaded
    document.onreadystatechange = () => {
      if (document.readyState === "complete") main();
    };
  </script>
</html>
